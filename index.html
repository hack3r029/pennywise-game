<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Vem Flutuar: Terror no Circo üéà</title>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">

<style>
  html, body {
    margin: 0;
    height: 100%;
    background-color: #05000a;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    touch-action: none;
    font-family: 'Press Start 2P', cursive;
  }

  /* Container para simular uma m√°quina de arcade */
  #game-container {
    position: relative;
    box-shadow: 0 0 50px rgba(138, 0, 0, 0.4);
    border: 4px solid #333;
    border-radius: 4px;
  }

  canvas {
    display: block;
    background: #1a0b2e;
    image-rendering: pixelated; /* Garante pixels n√≠tidos */
    width: 100%;
    height: 100%;
    max-width: 800px;
    max-height: 800px;
  }

  /* Efeito de TV antiga (Scanlines) */
  .scanlines {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: linear-gradient(
      to bottom,
      rgba(255,255,255,0),
      rgba(255,255,255,0) 50%,
      rgba(0,0,0,0.2) 50%,
      rgba(0,0,0,0.2)
    );
    background-size: 100% 4px;
    pointer-events: none;
    z-index: 10;
  }
</style>
</head>

<body>

<div id="game-container">
  <canvas id="game"></canvas>
  <div class="scanlines"></div>
</div>

<script>
/**
 * VEM FLUTUAR: REMASTERED
 * Criado por Gemini AI
 */

// ================= CONFIGURA√á√ÉO =================
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d", { alpha: false });

// Resolu√ß√£o interna baixa para look "Retro"
const GAME_W = 240;
const GAME_H = 320;
const SCALE = 3; // Escala visual

// Ajusta o tamanho do canvas
function resize() {
  let h = window.innerHeight;
  let w = window.innerWidth;
  
  // Mant√©m propor√ß√£o
  let ratio = GAME_W / GAME_H;
  
  // L√≥gica para caber na tela mantendo pixel perfect se poss√≠vel
  let finalH = Math.min(h, 800);
  let finalW = finalH * ratio;

  if (finalW > w) {
    finalW = w;
    finalH = finalW / ratio;
  }

  canvas.style.width = `${finalW}px`;
  canvas.style.height = `${finalH}px`;
  
  canvas.width = GAME_W;
  canvas.height = GAME_H;
}
window.addEventListener('resize', resize);
resize();

// ================= ESTADO GLOBAL =================
let state = "MENU"; // MENU, GAME, SHOP, GAMEOVER
let frames = 0;
let speed = 1.5;
let score = 0;
let coins = parseInt(localStorage.getItem("coins")) || 0;
let bestScore = parseInt(localStorage.getItem("best")) || 0;

// Paleta de Cores
const C = {
  bg: "#120b21",
  ground: "#090514",
  accent: "#ff0044",
  white: "#ffffff",
  gold: "#ffd700",
  textShade: "rgba(0,0,0,0.7)"
};

// Loja
let ownedItems = JSON.parse(localStorage.getItem("owned")) || ["red"];
let currentSkin = localStorage.getItem("skin") || "red";
const shopItems = [
  {id:"red", name:"Cl√°ssico", price:0, color:"#d11"},
  {id:"blue", name:"Noite", price:25, color:"#22aadd"},
  {id:"gold", name:"Luxo", price:60, color:"#ffd700"},
  {id:"void", name:"Vazio", price:100, color:"#a0a"}
];

// ================= √ÅUDIO (Sintetizador) =================
const AudioCtx = window.AudioContext || window.webkitAudioContext;
let actx = new AudioCtx();

function playSound(type) {
  if (actx.state === 'suspended') actx.resume();
  const osc = actx.createOscillator();
  const gain = actx.createGain();
  osc.connect(gain);
  gain.connect(actx.destination);

  const now = actx.currentTime;
  
  if (type === 'jump') {
    osc.type = 'square';
    osc.frequency.setValueAtTime(150, now);
    osc.frequency.linearRampToValueAtTime(300, now + 0.1);
    gain.gain.setValueAtTime(0.1, now);
    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
    osc.start(now);
    osc.stop(now + 0.1);
  } 
  else if (type === 'coin') {
    osc.type = 'triangle';
    osc.frequency.setValueAtTime(1200, now);
    osc.frequency.setValueAtTime(1800, now + 0.05);
    gain.gain.setValueAtTime(0.1, now);
    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);
    osc.start(now);
    osc.stop(now + 0.15);
  }
  else if (type === 'hit') {
    osc.type = 'sawtooth';
    osc.frequency.setValueAtTime(100, now);
    osc.frequency.exponentialRampToValueAtTime(30, now + 0.3);
    gain.gain.setValueAtTime(0.2, now);
    gain.gain.linearRampToValueAtTime(0, now + 0.3);
    osc.start(now);
    osc.stop(now + 0.3);
  }
}

// ================= ENTIDADES =================

// Jogador (O Palha√ßo)
const player = {
  x: 40, y: 100, w: 14, h: 20, vy: 0, gravity: 0.15,
  jumpStr: -2.8, 
  reset() { this.y = 100; this.vy = 0; },
  update() {
    this.vy += this.gravity;
    this.y += this.vy;
    
    // Ch√£o e Teto
    if (this.y > GAME_H - 25) hitObstacle(); 
    if (this.y < 0) this.y = 0;
  },
  draw() {
    let px = Math.floor(this.x);
    let py = Math.floor(this.y);
    
    // Corpo
    ctx.fillStyle = "#ddd"; // Roupa branca suja
    ctx.fillRect(px+2, py+8, 10, 10);
    
    // Bot√µes / Detalhes
    ctx.fillStyle = C.accent;
    ctx.fillRect(px+6, py+10, 2, 2);
    ctx.fillRect(px+6, py+14, 2, 2);

    // Cabe√ßa
    ctx.fillStyle = "#fff";
    ctx.fillRect(px+1, py, 12, 9);
    
    // Cabelo
    ctx.fillStyle = "#d00";
    ctx.fillRect(px-1, py+1, 3, 5); // Esq
    ctx.fillRect(px+12, py+1, 3, 5); // Dir
    
    // Rosto
    ctx.fillStyle = "#000"; // Olhos
    ctx.fillRect(px+3, py+3, 2, 2);
    ctx.fillRect(px+9, py+3, 2, 2);
    
    ctx.fillStyle = "#d00"; // Nariz
    ctx.fillRect(px+6, py+5, 2, 2);
  }
};

// Gerenciador de Objetos
let balloons = [];
let obstacles = [];
let particles = [];

// Classe Part√≠cula (Confete)
class Particle {
  constructor(x, y, color) {
    this.x = x; this.y = y;
    this.vx = (Math.random() - 0.5) * 4;
    this.vy = (Math.random() - 0.5) * 4;
    this.life = 30;
    this.color = color;
  }
  update() {
    this.x += this.vx; this.y += this.vy;
    this.life--;
  }
  draw() {
    ctx.fillStyle = this.color;
    ctx.globalAlpha = this.life / 30;
    ctx.fillRect(this.x, this.y, 2, 2);
    ctx.globalAlpha = 1;
  }
}

// Spawner
function spawnThings() {
  // Bal√µes
  if (frames % 70 === 0) {
    let by = 30 + Math.random() * (GAME_H - 100);
    balloons.push({ x: GAME_W, y: by, active: true, bobOffset: Math.random()*10 });
  }
  
  // Obst√°culos (Serras)
  // Aumenta dificuldade com o tempo
  let freq = score > 20 ? 90 : (score > 10 ? 120 : 150);
  if (frames % freq === 0) {
    let isTop = Math.random() > 0.5;
    let oy = isTop ? Math.random() * 60 : GAME_H - 80 - Math.random() * 60;
    obstacles.push({ x: GAME_W, y: oy, w: 20, h: 20, rot: 0 });
  }
}

// ================= SISTEMA DE JOGO =================

function updateGame() {
  player.update();

  // Velocidade aumenta levemente
  speed = 1.5 + (score * 0.02);
  if(speed > 3.5) speed = 3.5;

  // Atualiza Bal√µes
  for (let i = balloons.length - 1; i >= 0; i--) {
    let b = balloons[i];
    b.x -= speed;
    
    // Movimento suave vertical (bobbing)
    let floatY = b.y + Math.sin((frames + b.bobOffset * 10) * 0.1) * 3;

    // Colis√£o Player-Bal√£o
    if (
      b.active &&
      player.x < b.x + 8 && player.x + player.w > b.x &&
      player.y < floatY + 10 && player.y + player.h > floatY
    ) {
      b.active = false;
      score++;
      coins++;
      playSound('coin');
      // Spawn particles
      for(let k=0; k<8; k++) particles.push(new Particle(b.x, floatY, getBalloonColor()));
    }
    
    if (b.x < -20) balloons.splice(i, 1);
  }

  // Atualiza Obst√°culos
  for (let i = obstacles.length - 1; i >= 0; i--) {
    let o = obstacles[i];
    o.x -= speed;
    o.rot += 0.2; // Girar visualmente

    // Colis√£o Player-Obst√°culo (Hitbox menor para ser justo)
    let buffer = 4;
    if (
      player.x + buffer < o.x + o.w - buffer && 
      player.x + player.w - buffer > o.x + buffer &&
      player.y + buffer < o.y + o.h - buffer && 
      player.y + player.h - buffer > o.y + buffer
    ) {
      hitObstacle();
    }

    if (o.x < -30) obstacles.splice(i, 1);
  }

  // Atualiza Part√≠culas
  for (let i = particles.length - 1; i >= 0; i--) {
    particles[i].update();
    if (particles[i].life <= 0) particles.splice(i, 1);
  }
}

function hitObstacle() {
  playSound('hit');
  if (score > bestScore) {
    bestScore = score;
    localStorage.setItem("best", bestScore);
  }
  localStorage.setItem("coins", coins);
  state = "GAMEOVER";
}

function getBalloonColor() {
  let item = shopItems.find(i => i.id === currentSkin);
  return item ? item.color : "#d11";
}

// ================= DESENHO (RENDER) =================

function drawSaw(x, y, rot) {
  ctx.save();
  ctx.translate(x + 10, y + 10);
  ctx.rotate(rot);
  ctx.fillStyle = "#888";
  ctx.beginPath();
  // Desenha uma estrela simples (serra)
  for (let i = 0; i < 8; i++) {
    ctx.rotate(Math.PI / 4);
    ctx.fillRect(-2, -10, 4, 8);
  }
  ctx.fillStyle = "#555";
  ctx.fillRect(-4, -4, 8, 8); // Eixo
  ctx.restore();
}

function drawBackground() {
  // C√©u
  ctx.fillStyle = C.bg;
  ctx.fillRect(0, 0, GAME_W, GAME_H);

  // Estrelas / Poeira
  ctx.fillStyle = "#443355";
  for(let i=0; i<20; i++) {
    let sx = (i * 37 + frames * 0.2) % GAME_W;
    let sy = (i * 19) % (GAME_H/2);
    ctx.fillRect(sx, sy, 1, 1);
  }

  // Camada Distante (√Årvores Escuras) - Parallax Lento
  ctx.fillStyle = "#1e1433";
  let px1 = -(frames * 0.5) % 40;
  for (let i = -1; i < GAME_W / 20 + 1; i++) {
    let h = 40 + Math.sin(i * 132) * 15;
    ctx.fillRect(px1 + i * 40, GAME_H - h - 10, 25, h);
  }

  // Camada Perto (Tendas/Grades) - Parallax M√©dio
  ctx.fillStyle = "#2d1b4e";
  let px2 = -(frames * 1.0) % 60;
  for (let i = -1; i < GAME_W / 40 + 1; i++) {
    // Postes de cerca
    ctx.fillRect(px2 + i * 60, GAME_H - 40, 4, 40);
    // Correntes
    ctx.fillRect(px2 + i * 60 + 4, GAME_H - 35, 56, 1);
  }

  // Ch√£o
  ctx.fillStyle = "#000";
  ctx.fillRect(0, GAME_H - 20, GAME_W, 20);
  // Grama morta
  ctx.fillStyle = "#261530";
  ctx.fillRect(0, GAME_H - 22, GAME_W, 4);
}

function render() {
  drawBackground();

  // Part√≠culas (Atr√°s do HUD)
  particles.forEach(p => p.draw());

  if (state === "GAME" || state === "GAMEOVER") {
    // Bal√µes
    let bColor = getBalloonColor();
    balloons.forEach(b => {
      if (!b.active) return;
      let y = b.y + Math.sin((frames + b.bobOffset * 10) * 0.1) * 3;
      
      // Fio
      ctx.fillStyle = "#fff";
      ctx.fillRect(b.x + 3, y + 8, 1, 8);
      
      // Bal√£o
      ctx.fillStyle = bColor;
      ctx.beginPath();
      ctx.roundRect(b.x, y, 8, 10, 2);
      ctx.fill();
      // Brilho
      ctx.fillStyle = "rgba(255,255,255,0.4)";
      ctx.fillRect(b.x + 2, y + 2, 2, 2);
    });

    // Serras
    obstacles.forEach(o => drawSaw(o.x, o.y, o.rot));

    // Player
    player.draw();

    // HUD
    ctx.fillStyle = C.textShade;
    ctx.fillRect(5, 5, 80, 16);
    ctx.fillStyle = C.white;
    ctx.textAlign = "left";
    ctx.font = "8px 'Press Start 2P'";
    ctx.fillText(`SCORE: ${score}`, 8, 16);
  }
  
  if (state === "MENU") drawMenu();
  if (state === "GAMEOVER") drawGameOver();
  if (state === "SHOP") drawShop();
}

// ================= UI INTERFACES =================

function drawBtn(text, x, y, w, h, highlight=false) {
  ctx.fillStyle = highlight ? C.accent : "#333";
  ctx.fillRect(x, y, w, h);
  
  // Borda 3D simples
  ctx.fillStyle = "#fff";
  ctx.fillRect(x, y, w, 2); // top
  ctx.fillRect(x, y, 2, h); // left
  ctx.fillStyle = "#000";
  ctx.fillRect(x, y+h-2, w, 2); // bot
  ctx.fillRect(x+w-2, y, 2, h); // right
  
  ctx.fillStyle = "#fff";
  ctx.textAlign = "center";
  ctx.fillText(text, x + w/2, y + h/2 + 3);
}

function drawMenu() {
  ctx.fillStyle = "rgba(0,0,0,0.6)";
  ctx.fillRect(20, 40, GAME_W-40, GAME_H-80);
  
  ctx.fillStyle = C.accent;
  ctx.textAlign = "center";
  ctx.font = "12px 'Press Start 2P'";
  ctx.fillText("VEM FLUTUAR", GAME_W/2, 70);
  
  ctx.fillStyle = "#888";
  ctx.font = "8px 'Press Start 2P'";
  ctx.fillText("TERROR NO CIRCO", GAME_W/2, 85);

  ctx.fillStyle = C.gold;
  ctx.fillText(`BEST: ${bestScore}`, GAME_W/2, 110);
  ctx.fillText(`COINS: ${coins}`, GAME_W/2, 125);

  drawBtn("JOGAR", GAME_W/2 - 40, 160, 80, 20, true);
  drawBtn("LOJA", GAME_W/2 - 40, 190, 80, 20);
}

function drawGameOver() {
  ctx.fillStyle = "rgba(50,0,0,0.8)";
  ctx.fillRect(30, 80, GAME_W-60, 120);
  
  ctx.fillStyle = "#f00";
  ctx.textAlign = "center";
  ctx.font = "12px 'Press Start 2P'";
  ctx.fillText("GAME OVER", GAME_W/2, 110);
  
  ctx.fillStyle = "#fff";
  ctx.font = "8px 'Press Start 2P'";
  ctx.fillText(`Final: ${score}`, GAME_W/2, 135);
  
  // Piscar
  if (Math.floor(frames/30) % 2 === 0) {
    ctx.fillText("Toque para Menu", GAME_W/2, 170);
  }
}

function drawShop() {
  ctx.fillStyle = "#111";
  ctx.fillRect(10, 10, GAME_W-20, GAME_H-20);
  
  ctx.fillStyle = C.gold;
  ctx.textAlign = "center";
  ctx.font = "10px 'Press Start 2P'";
  ctx.fillText("LOJA DE BAL√ïES", GAME_W/2, 35);
  
  ctx.textAlign = "left";
  ctx.font = "8px 'Press Start 2P'";
  ctx.fillText(`MOEDAS: ${coins}`, 20, 55);

  let startY = 70;
  shopItems.forEach((item, idx) => {
    let y = startY + idx * 35;
    let owned = ownedItems.includes(item.id);
    let equipped = currentSkin === item.id;
    
    // Box
    ctx.strokeStyle = equipped ? C.gold : "#444";
    ctx.strokeRect(20, y, GAME_W-40, 28);
    
    // Cor
    ctx.fillStyle = item.color;
    ctx.fillRect(26, y+8, 12, 12);
    
    // Nome
    ctx.fillStyle = "#fff";
    ctx.fillText(item.name, 46, y+12);
    
    // Pre√ßo / Status
    if (equipped) {
      ctx.fillStyle = "#0f0";
      ctx.fillText("USANDO", 46, y+22);
    } else if (owned) {
      ctx.fillStyle = "#aaa";
      ctx.fillText("TOCA P/ USAR", 46, y+22);
    } else {
      ctx.fillStyle = C.gold;
      ctx.fillText(`${item.price} $`, 46, y+22);
    }
  });

  drawBtn("VOLTAR", GAME_W/2 - 30, GAME_H - 40, 60, 20);
}

// ================= INPUT HANDLER =================
function handleInput(e) {
  e.preventDefault();
  
  // Coordenadas do clique relativas ao Canvas interno
  const rect = canvas.getBoundingClientRect();
  const scaleX = canvas.width / rect.width;
  const scaleY = canvas.height / rect.height;
  
  let clientX = e.clientX || e.changedTouches[0].clientX;
  let clientY = e.clientY || e.changedTouches[0].clientY;
  
  let x = (clientX - rect.left) * scaleX;
  let y = (clientY - rect.top) * scaleY;

  if (state === "MENU") {
    // Bot√£o JOGAR
    if (x > GAME_W/2 - 40 && x < GAME_W/2 + 40 && y > 160 && y < 180) {
      resetGame();
      state = "GAME";
    }
    // Bot√£o LOJA
    else if (x > GAME_W/2 - 40 && x < GAME_W/2 + 40 && y > 190 && y < 210) {
      state = "SHOP";
    }
  }
  else if (state === "GAME") {
    player.vy = player.jumpStr;
    playSound('jump');
  }
  else if (state === "GAMEOVER") {
    state = "MENU";
  }
  else if (state === "SHOP") {
    // Voltar
    if (x > GAME_W/2 - 30 && x < GAME_W/2 + 30 && y > GAME_H - 40 && y < GAME_H - 20) {
      state = "MENU";
      return;
    }
    
    // Clique nos Itens
    let startY = 70;
    shopItems.forEach((item, idx) => {
      let iy = startY + idx * 35;
      if (x > 20 && x < GAME_W-20 && y > iy && y < iy + 28) {
        if (ownedItems.includes(item.id)) {
          currentSkin = item.id;
          localStorage.setItem("skin", currentSkin);
          playSound('jump');
        } else if (coins >= item.price) {
          coins -= item.price;
          ownedItems.push(item.id);
          currentSkin = item.id;
          localStorage.setItem("owned", JSON.stringify(ownedItems));
          localStorage.setItem("skin", currentSkin);
          localStorage.setItem("coins", coins);
          playSound('coin');
        } else {
          playSound('hit'); // Erro
        }
      }
    });
  }
}

function resetGame() {
  player.reset();
  balloons = [];
  obstacles = [];
  particles = [];
  score = 0;
  frames = 0;
  speed = 1.5;
}

window.addEventListener("mousedown", handleInput);
window.addEventListener("touchstart", handleInput, {passive: false});
window.addEventListener("keydown", (e) => {
  if (e.code === "Space" || e.code === "ArrowUp") {
    // Simula clique no centro da tela para atalho de teclado
    handleInput({
      preventDefault:()=>{}, 
      clientX: window.innerWidth/2, 
      clientY: window.innerHeight/2
    });
  }
});

// ================= LOOP PRINCIPAL =================
function loop() {
  frames++;
  ctx.clearRect(0, 0, GAME_W, GAME_H);
  
  if (state === "GAME") {
    spawnThings();
    updateGame();
  }
  
  render();
  requestAnimationFrame(loop);
}

// Iniciar
loop();

</script>
</body>
</html>
