<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Vem Flutuar üéà</title>

<style>
body{
    margin:0;
    background:#0b0018;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    font-family:monospace;
}
canvas{
    image-rendering:pixelated;
    border:6px solid #000;
    background:#000;
}
</style>
</head>

<body>
<canvas id="game"></canvas>

<script>
// ================= CONFIG =================
const SCALE = 3;
const W = 160, H = 240;

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = W * SCALE;
canvas.height = H * SCALE;
ctx.scale(SCALE, SCALE);
ctx.font = "8px monospace";

// ================= STATE =================
let state = "menu";
let score = 0;
let coins = Number(localStorage.getItem("coins")) || 0;
let best = Number(localStorage.getItem("best")) || 0;
let frame = 0;
let canTap = true;

// ================= AUDIO (S√ì GAME OVER) =================
let audioCtx = null;
function initAudio(){
    if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)();
}
function loseMusic(){
    if(!audioCtx) return;
    const seq = [220,180,140];
    seq.forEach((f,i)=>{
        setTimeout(()=>{
            const o=audioCtx.createOscillator(),g=audioCtx.createGain();
            o.type="square";o.frequency.value=f;
            g.gain.value=0.05;
            o.connect(g);g.connect(audioCtx.destination);
            o.start();o.stop(audioCtx.currentTime+0.3);
        },i*300);
    });
}

// ================= CEN√ÅRIO DERRY (SCROLL) =================
let bgX = 0;
let signX = 260;

function drawBackground(){
    // c√©u
    ctx.fillStyle = "#12001f";
    ctx.fillRect(0,0,W,H);

    // lua
    ctx.fillStyle="#ddd";
    ctx.fillRect(120,20,12,12);

    // pr√©dios (parallax)
    for(let layer=0; layer<3; layer++){
        const speed = 0.2 + layer*0.2;
        const color = ["#1a0033","#24004a","#300066"][layer];
        for(let i=0;i<20;i++){
            const x = (i*16 - (bgX*speed)%16);
            const h = 40 + (i*13)%30 + layer*10;
            ctx.fillStyle=color;
            ctx.fillRect(x,H-h-10,16,h);
        }
    }

    // circo
    ctx.fillStyle="#6b0000";
    ctx.fillRect(30-bgX*0.6,H-60,100,30);
    ctx.fillStyle="#ff0000";
    for(let i=0;i<7;i++){
        ctx.fillRect(30-bgX*0.6+i*14,H-60,7,30);
    }

    // placa WELCOME TO DERRY (passando)
    ctx.fillStyle="#111";
    ctx.fillRect(signX, H-90, 110, 14);
    ctx.fillStyle="#fff";
    ctx.fillText("WELCOME TO DERRY", signX+6, H-80);

    // ch√£o
    ctx.fillStyle="#050010";
    ctx.fillRect(0,H-10,W,10);

    bgX += 0.4;
    signX -= 0.4;

    if(signX < -140){
        signX = W + Math.random()*200;
    }
}

// ================= PLAYER =================
const player = {
    x: 40,
    y: 80,
    w: 14,
    h: 20,
    vy: 0,

    reset(){
        this.y = 80;
        this.vy = 0;
    },

    update(){
        this.vy += 0.07;
        this.y += this.vy;
        if(this.y + this.h >= H-10){
            this.y = H-10-this.h;
            gameOver();
        }
    },

    jump(){
        this.vy = -1.6;
    },

    draw(){
        // cabelo
        ctx.fillStyle="#ff6a00";
        ctx.fillRect(this.x-2,this.y,4,10);
        ctx.fillRect(this.x+12,this.y,4,10);

        // cabe√ßa
        ctx.fillStyle="#fff";
        ctx.fillRect(this.x+2,this.y,10,8);

        // olhos
        ctx.fillStyle="#000";
        ctx.fillRect(this.x+4,this.y+3,2,2);
        ctx.fillRect(this.x+8,this.y+3,2,2);

        // marcas vermelhas
        ctx.fillStyle="#aa0000";
        ctx.fillRect(this.x+6,this.y+5,2,6);

        // corpo
        ctx.fillStyle="#ddd";
        ctx.fillRect(this.x+3,this.y+8,8,12);
    }
};

// ================= BAL√ïES =================
let balloonColor = localStorage.getItem("balloonColor") || "#ff0000";
let balloons = [];

function spawnBalloon(){
    balloons.push({
        x: W + 10,
        y: Math.random()*120 + 40
    });
}

function updateBalloons(){
    for(let i=balloons.length-1;i>=0;i--){
        const b = balloons[i];
        b.x -= 0.8;

        if(
            player.x < b.x + 6 &&
            player.x + player.w > b.x &&
            player.y < b.y + 8 &&
            player.y + player.h > b.y
        ){
            balloons.splice(i,1);
            score++;
            coins++;
            continue;
        }

        if(b.x < -10) balloons.splice(i,1);
    }
}

function drawBalloons(){
    balloons.forEach(b=>{
        ctx.fillStyle=balloonColor;
        ctx.fillRect(b.x,b.y,6,8);
        ctx.fillStyle="#444";
        ctx.fillRect(b.x+3,b.y+8,1,6);
    });
}

// ================= HUD =================
function drawHUD(){
    ctx.fillStyle="rgba(0,0,0,.6)";
    ctx.fillRect(0,0,W,14);
    ctx.fillStyle="#fff";
    ctx.fillText("üéà "+score,6,10);
    ctx.fillText("üí∞ "+coins,W-55,10);
}

// ================= GAME OVER =================
function gameOver(){
    state="gameover";
    best=Math.max(best,score);
    localStorage.setItem("best",best);
    localStorage.setItem("coins",coins);
    initAudio();
    loseMusic();
}

// ================= MENU =================
function drawMenu(){
    drawBackground();
    ctx.fillStyle="rgba(0,0,0,.7)";
    ctx.fillRect(20,50,W-40,140);

    ctx.fillStyle="#ff0000";
    ctx.fillText("üé™ VEM FLUTUAR üé™",32,75);
    ctx.fillStyle="#fff";
    ctx.fillText("RECORDE: "+best,42,100);
    ctx.fillText("MOEDAS: "+coins,42,115);

    drawButton(40,140,"JOGAR");
    drawButton(40,165,"LOJA");
}

// ================= SHOP (BASE VISUAL) =================
function drawShop(){
    drawBackground();
    ctx.fillStyle="rgba(0,0,0,.8)";
    ctx.fillRect(10,20,W-20,200);

    ctx.fillStyle="#ffd700";
    ctx.fillText("üé† LOJA DO CIRCO üé†",28,40);
    ctx.fillStyle="#fff";
    ctx.fillText("EM BREVE MAIS ITENS",30,90);
    drawButton(20,200,"VOLTAR");
}

// ================= BUTTON =================
function drawButton(x,y,text){
    ctx.fillStyle="#fff";
    ctx.fillRect(x,y,120,16);
    ctx.strokeStyle="#000";
    ctx.strokeRect(x,y,120,16);
    ctx.fillStyle="#000";
    ctx.fillText(text,x+6,y+11);
}

// ================= INPUT =================
function tap(x,y){
    if(!canTap) return;
    canTap=false;

    if(state==="menu"){
        if(y>140 && y<156) startGame();
        else if(y>165 && y<181) state="shop";
    }
    else if(state==="shop"){
        if(y>200) state="menu";
    }
    else if(state==="game"){
        player.jump();
    }
    else if(state==="gameover"){
        state="menu";
    }
}

canvas.addEventListener("mousedown",e=>{
    const r=canvas.getBoundingClientRect();
    tap((e.clientX-r.left)/SCALE,(e.clientY-r.top)/SCALE);
});
canvas.addEventListener("mouseup",()=>canTap=true);

canvas.addEventListener("touchstart",e=>{
    const r=canvas.getBoundingClientRect();
    tap((e.touches[0].clientX-r.left)/SCALE,(e.touches[0].clientY-r.top)/SCALE);
});
canvas.addEventListener("touchend",()=>canTap=true);

// ================= START =================
function startGame(){
    score=0;
    balloons=[];
    player.reset();
    frame=0;
    state="game";
}

// ================= LOOP =================
function loop(){
    ctx.clearRect(0,0,W,H);

    if(state==="menu") drawMenu();
    else if(state==="shop") drawShop();
    else if(state==="game"){
        drawBackground();
        player.update();
        updateBalloons();
        if(frame%90===0) spawnBalloon();
        drawBalloons();
        player.draw();
        drawHUD();
    }
    else if(state==="gameover"){
        drawBackground();
        ctx.fillStyle="rgba(0,0,0,.75)";
        ctx.fillRect(20,90,W-40,90);
        ctx.fillStyle="#ff0000";
        ctx.fillText("üé≠ GAME OVER üé≠",34,120);
        ctx.fillStyle="#fff";
        ctx.fillText("BAL√ïES: "+score,42,140);
        ctx.fillText("TOQUE P/ MENU",30,165);
    }

    frame++;
    requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
